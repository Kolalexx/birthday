<?php
use Psr\Http\Message\ResponseInterface as Response;
use Psr\Http\Message\ServerRequestInterface as Request;
use Slim\Factory\AppFactory;

require __DIR__ . '/../vendor/autoload.php';

$app = AppFactory::create();

$codes = [
    "7T9K3" => "✅ Любимая моя, с Днём Рождения! 💐🎉 Сегодня всё — только для тебя: загадки, сюрпризы и конечно моя бесконечная любовь. Готовься к приключению! А начнём мы с самого прекрасного... Пусть в твоей жизни будет больше ярких красок, лёгкости и волшебства — как в этих цветах! Следующий подарок прячется совсем рядом, за закрытой дверью. Он ждет, когда ты раскроешь его секрет... Найди его — и он шепнет тебе, куда отправиться дальше!",
    "Q1H6Y" => "🎁 Любимочка! Ты — как эти воздушные шарики: 🔹 Яркая — освещаешь мою жизнь, 🔹 Лёгкая — наполняешь её счастьем, 🔹 Воздушная — от одного твоего взгляда сердце взлетает к облакам! Но даже воздушным шарикам нужна «подпитка»… Следующий сюрприз ждёт тебя там, где рождаются самые вкусные моменты нашего дня! 🍫✨",
    "9F3D7" => "✅ Моя половиночка! Ты как эта икра - драгоценна, изысканна и даришь мгновения наслаждения! 🍽️✨ Следующий сюрприз ждёт тебя там, где воздух наполнен ароматом весны… Ищи там, где цветут самые романтичные воспоминания. 🌸",
    "5N8J2" => "🎁 С Днём Рождения, моя единственная! 💜 Ты — как эти цветы: ✨ Нежная — как их лепестки, ✨ Яркая — как их соцветия в лучах солнца, ✨ В тебе как в их аромате хочется тонуть снова и снова... Пусть этот год подарит тебе счастья, удачу и исполнение желаний. А эти духи пусть напоминают: ты — мой самый желанный и прекрасный цветок жизни! 🌸💐 А теперь — пора подкрепиться! 🍽️✨...нас ждёт столик по адресу улица Новороссийской Республики, 6. �🚗",
    "K4B1L" => "✅ Любимая моя, в этот особенный день я дарю тебе не просто книгу — а новую вселенную, в которую мы отправимся вместе. Пусть её страницы будут такими же увлекательными, как наша жизнь, Герои — такими же яркими, как ты, А финал — таким же счастливым, как я рядом с тобой. Но помни: лучшая история — это та, что мы пишем вместе день за днём. 💖 P.S. Когда будешь готова продолжить приключение — проверь место, где • Километры превращаются в моменты, • А навигатор ведёт к счастью 🚗💫💜",
    "3V6W9" => "🎁 Любимая, этот чехол — как и я: 🔹 Надёжный — готов беречь твои важные моменты, 🔹 Стильный — как и ты, 🔹 Всегда рядом — готовый отправиться с тобой куда угодно! 📱💖 Пусть он хранит не только твой телефон, но и наши общие воспоминания — ведь лучшие приключения ещё впереди! А теперь — пора возвращаться туда, где начинается и заканчивается каждый наш день… Там, где пахнет уютом и ждёт следующий сюрприз! 🏠✨",
    "P7Z2M" => "✅ Любимочка, сегодня — день, когда сбываются мечты! 💫 Этот телефон — как наша любовь: ✨ Современный — чтобы идти в ногу со временем, ✨ Мощный — чтобы справляться с любыми трудностями, ✨ Яркий — как твои глаза, когда ты счастлива. Пусть он сохранит все наши лучшие моменты, а новые технологии сделают твою жизнь ещё удобнее и прекраснее! 💖 Но самое главное — это не гаджет, а то, что мы вместе.",
    "8G5T4" => "🎁 Дорогая, позволь мне пригласить тебя на романтический ужин! 🌹 Где: [Название ресторана] ⏰ Во сколько: [Время] 💐 Дресс-код: Ты — самая красивая (как всегда!) Пусть этот вечер станет идеальным завершением твоего дня! Я уже зарезервировал столик с видом на море. Готова к новому приключению? 💖",
    "2X5L9" => "✅ ",
];

$app->get('/', function (Request $request, Response $response) {
    $html = file_get_contents(__DIR__ . '/../templates/index.html');
    $response->getBody()->write($html);
    return $response;
});

$app->post('/check-code', function (Request $request, Response $response) use ($codes) {
    $data = $request->getParsedBody();
    $code = $data['code'] ?? '';

    $result = htmlspecialchars($codes[$code] ?? "⚠️ Код недействителен");

    $response->getBody()->write(json_encode(['message' => $result], JSON_UNESCAPED_UNICODE));
    return $response->withHeader('Content-Type', 'application/json');
});

$app->get('/favicon.ico', function (Request $request, Response $response) {
    return $response->withStatus(404);
});

$app->map(['GET', 'POST'], '/{routes:.+}', function ($request, $response) {
    return $response->withStatus(404)->write('Страница не найдена');
});

$app->run();
